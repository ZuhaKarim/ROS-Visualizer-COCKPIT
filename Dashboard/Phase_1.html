<html>
    <head>
        <title>youBot Dashboard</title>
        <meta charset="utf-8">
        <link href="../base1/cockpit.css" type="text/css" rel="stylesheet">
        <script src="../base1/jquery.js"></script>
        <script src="../base1/cockpit.js"></script>
    </head>
    <body>
        <header>
            <div class = 'title'>
                <h1>youBot Dashboard</h1>
            </div>
            <div class = 'Phase-1'>
                <input type = "button" onClick = ret_path(); value = "Start ROS" id = "ROS_START">
                <input type = "button" onclick = launch_file(); value = "Bring up" id = "BRINGUP_LAUNCH">
            </div>
        </header>
        <script>
        var interval;
        var path;
        var run_time = 0;
        /*
         Function to locate the start_check_ros.sh file so that it works in any system
         this function is invoked on click of start ROS button
        */
        function ret_path(){
            var proc1 = cockpit.script("locate start_check_ros_2.sh");
            proc1.stream(get_path);
        }
        /*
         This function is used to read the file path from ret_path function and calls 
         start_ros function with path to start_check_ros.sh as argument
        */
        function get_path(data){
            path = data
            console.log("data")
            console.log(path)
            start_ros(path);
        }
        /*
         This function is used to start ros if not running.
        */
        function start_ros(path) {
            path = path.trim()
            console.log(typeof(path))
            var command = ["bash", path, "1"].join(" ");
            console.log("In path")
            console.log(command)
            var proc = cockpit.script(command)
            proc.stream(ping_output);
            check_ros(path);
        }
        
        /*
         This function is used to set the interval to check roscore status.
        */
        function check_ros(path){
            interval = setInterval(function() {check_ros_run(path);},2000);
        }

        /*
         This function is used to check whether the roscore is running or not.
        */
        function check_ros_run(path){
            console.log("In chec ros run")
            path = path.trim()
            var command = ["bash", path, "0"].join(" ");
            console.log(command)
            // var proc = cockpit.script("bash /home/lokesh/pinger/bash_files/start_check_ros.sh 0");
            var proc = cockpit.script(command)
            proc.stream(ping_output);
        }
        /*
         In this function the color of the start ROS button is changed according to the status from
         check_ros_run and start_ros functions
        */
        function ping_output(data) {
            console.log("In ping_output method")
            console.log(data)
            if (data == 1)
            {
                document.getElementById("ROS_START").style.background = "#32CD32";
            }
            else if (data == 0){
                clearInterval(interval);
                document.getElementById("ROS_START").style.background = "#FF4500";
            }
        }
        </script>
    </body>      
</html>